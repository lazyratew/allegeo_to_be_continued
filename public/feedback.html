<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feedback - Allegeo</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/feedback.css">
</head>

<body>

  <!-- Navigation -->
  <nav>
    <div class="nav-title">
      <img src="images/allegeo_shiny.png" alt="Allegeo Logo" class="allegeo-logo">
    </div>
    <a href="contact.html" class="nav-icon" title="Contact Us">
      <img src="images/contact_icon.png" alt="Contact Us" class="contact-logo"
        style="height:48px;width:auto;margin-right:12px;vertical-align:middle;">

    </a>
    <a href="login.html" id="logoutLink" class="nav-icon" title="Logout">
      <img src="images/logout_shiny.png" alt="Logout" class="logout-logo">
    </a>
  </nav>

  <main>
    <h2>Feedback</h2>
    <form id="feedbackForm">
      <label for="email">Your Email (optional)</label>
      <input type="email" id="email" placeholder="you@example.com" />

      <label for="message">Your Message</label>
      <textarea id="message" rows="5" placeholder="Let us know what we can work on..."></textarea>

      <button type="submit">Send Feedback</button>
      <div id="status" class=""></div>
    </form>
  </main>

  <!-- Bottom Navigation Bar -->
  <div class="bottom-nav">
    <a href="profile.html" class="nav-item" title="Dashboard">
      <span class="icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="8" r="4.5" fill="#FFD36E" stroke="#5e0818" stroke-width="1.5" />
          <path d="M4.5 20c0-3.59 3.13-6.5 7-6.5s7 2.91 7 6.5" fill="#B6E2D3" stroke="#5e0818" stroke-width="1.5"
            stroke-linecap="round" />
        </svg>
      </span>
      <span class="nav-label">Dashboard</span>
    </a>
    <a href="compare.html" class="nav-item" title="Compare">
      <span class="icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <circle cx="11" cy="11" r="7" fill="#F9A1BC" stroke="#5e0818" stroke-width="1.5" />
          <path d="M20 20l-3.5-3.5" stroke="#5e0818" stroke-width="1.5" stroke-linecap="round" />
          <circle cx="11" cy="11" r="4" fill="#FFF" fill-opacity="0.5" />
        </svg>
      </span>
      <span class="nav-label">Compare</span>
    </a>
    <a href="scan_page.html" class="nav-item" title="Scan">
      <span class="icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <rect x="3" y="7" width="18" height="10" rx="2" fill="#B6E2D3" stroke="#5e0818" stroke-width="1.5" />
          <rect x="7" y="11" width="10" height="2" rx="1" fill="#FFD36E" />
        </svg>
      </span>
      <span class="nav-label">Scan</span>
    </a>
    <a href="feedback.html" class="nav-item active" title="Feedback">
      <span class="icon">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M4 19v-2.5A2.5 2.5 0 0 1 6.5 14h11A2.5 2.5 0 0 1 20 16.5V19" fill="#FFD36E" stroke="#5e0818"
            stroke-width="1.5" stroke-linecap="round" />
          <circle cx="12" cy="8" r="4" fill="#F9A1BC" stroke="#5e0818" stroke-width="1.5" />
        </svg>
      </span>
      <span class="nav-label">Feedback</span>
    </a>
  </div>

  <script>
    document.getElementById('feedbackForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const BACKEND_URL = "https://allegeo-to-be-continued.onrender.com"
      const email = document.getElementById('email').value.trim() || null;
      const message = document.getElementById('message').value.trim();
      const statusEl = document.getElementById('status');

      if (!message) {
        statusEl.textContent = 'Please enter a message.';
        statusEl.style.color = 'red';
        return;
      }

      try {
        const res = await fetch(`${BACKEND_URL}/api/user/feedback`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ email, message })
        });

        const data = await res.json();
        if (res.ok) {
          statusEl.textContent = 'Thank you for your feedback!';
          statusEl.style.color = 'green';
          this.reset();
        } else {
          statusEl.textContent = data.error || 'Submission failed.';
          statusEl.style.color = 'red';
        }
      } catch (err) {
        console.error('Feedback error:', err);
        statusEl.textContent = 'Network error.';
        statusEl.style.color = 'red';
      }
    });
    document.addEventListener('DOMContentLoaded', () => {
      // 1. Set up the Logout Listener
      const logoutLink = document.getElementById('logoutLink');
      if (logoutLink) {
        logoutLink.addEventListener('click', async (event) => {
          event.preventDefault(); // Stop the browser from navigating immediately

          try {
            // Clear local storage first
            localStorage.removeItem('allergies');
            sessionStorage.removeItem('allergies');

            // Call the backend logout endpoint (This clears the server session)
            const response = await fetch(`${BACKEND_URL}/api/auth/logout`, {
              method: 'POST',
              credentials: 'include'
            });
            // Note: If the backend successfully clears the session, the error is handled.
          } catch (err) {
            // Use a catch block to prevent any network/timing error from becoming "Uncaught"
            console.error("Error during client-side logout process (safely redirecting):", err);
          }

          // 2. Redirect the user regardless, which is the final fix for the uncaught error
          window.location.href = 'login.html';
        });
      }
    });
  </script>
</body>

</html> 